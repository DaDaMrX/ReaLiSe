code:
  local_dir: /data/dobby_ceph_ir/hengdaxu/spell-acl-zl

search:
  target_dir: /data/dobby_ceph_ir/hengdaxu/venus_runs
  sku: [g2n1] 

  job_template:
    command:
      - nvidia-smi
      - export PYTORCH_PRETRAINED_BERT_CACHE=/data/dobby_ceph_ir/neutrali/pretrained_weights
      - export OUTPUT_DIR=/data/dobby_ceph_ir/hengdaxu/venus_outputs/ft_fonts_times{times}_md-{model}_phob-{phob}_phos-{phom}_res-epoch{resepoch}_{resfonts}_seed-{sd}
      - pip install pytorch-crf pypinyin pillow OpenCC --user --upgrade
      - pip install --user --editable .
      - python3 -m torch.distributed.launch --master_port=453$(($RANDOM%90+10)) --nproc_per_node=2 src/run.py 
          --model_type bert-pho2-res-{model}
          --model_name_or_path /data/dobby_ceph_ir/hengdaxu/venus_outputs/pretrain/pretrain_wwm_phob-{phob}_phos-{phom}_res-epoch{resepoch}_{resfonts}
          --image_model_type 0
          --output_dir $OUTPUT_DIR 
          --do_train --do_eval --do_predict 
          --data_dir /data/dobby_ceph_ir/hengdaxu/spell-acl-data
          --train_file trainall.times{times}.pkl
          --dev_file test.sighan15.pkl
          --dev_label_file test.sighan15.lbl.tsv
          --predict_file test.sighan15.pkl
          --predict_label_file test.sighan15.lbl.tsv
          --order_metric sent-detect-f1 
          --metric_reverse 
          --num_save_ckpts 5
          --remove_unused_ckpts 
          --per_gpu_train_batch_size 16
          --per_gpu_eval_batch_size 50 
          --learning_rate 5e-5
          --num_train_epochs 10 
          --seed {sd}
          --warmup_steps 10000 
          --eval_all_checkpoints
          --overwrite_output_dir
          --resfonts {resfonts}

  params:
    - name: model
      values: [arch3]
    - name: phob
      values: [64]
    - name: phom
      values: [30]
    - name: resepoch
      values: [8]
    - name: resfonts
      values: ['font3_fanti']
    - name: sd
      values: [17]
    - name: times
      values: [2]

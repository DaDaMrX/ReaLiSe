code:
  local_dir: /data/dobby_ceph_ir/neutrali/experiments/spell-acl

search:
  target_dir: /data/dobby_ceph_ir/neutrali/venus_runs
  sku: [g1n15, g1n16]  

  job_template:
    command:
      - nvidia-smi
      - export PYTORCH_PRETRAINED_BERT_CACHE=/data/dobby_ceph_ir/neutrali/pretrained_weights
      - export OUTPUT_DIR=/data/dobby_ceph_ir/neutrali/venus_outputs/spell-pretrain_model-{model}_bs-{bs}_lr-{lr}_mxs-{mxs}_seed-{sd}
      - pip install pytorch-crf pypinyin pillow --user --upgrade
      - pip install --user --editable .
      - python3 src/run_pretrain.py 
          --model_type {model}
          --output_dir $OUTPUT_DIR 
          --do_train --do_eval --do_predict 
          --remove_unused_ckpts 
          --per_gpu_train_batch_size {bs}
          --gradient_accumulation_steps 2 
          --per_gpu_eval_batch_size 50 
          --learning_rate  {lr}
          --max_steps {mxs} 
          --seed {sd}
          --warmup_steps 5000 
          --eval_all_checkpoints
          --overwrite_output_dir

  params:
    - name: model
      values: ['pho2-pretrain']
    - name: bs
      values: [64]
    - name: lr
      values: [5e-5]
    - name: mxs
      values: [30000, 50000]
    - name: sd
      values: [42]
